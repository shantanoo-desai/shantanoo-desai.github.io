<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>CI/CD Notes: Nest.JS + TravisCI + Docker - Shan's Corner</title><meta name=Description content="A quick blog on how to make Travis CI push your App's Docker Image to Docker Hub after successful testing."><meta property="og:title" content="CI/CD Notes: Nest.JS + TravisCI + Docker"><meta property="og:description" content="A quick blog on how to make Travis CI push your App's Docker Image to Docker Hub after successful testing."><meta property="og:type" content="article"><meta property="og:url" content="https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/"><meta property="article:published_time" content="2020-04-25T18:00:00+02:00"><meta property="article:modified_time" content="2020-04-25T18:00:00+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="CI/CD Notes: Nest.JS + TravisCI + Docker"><meta name=twitter:description content="A quick blog on how to make Travis CI push your App's Docker Image to Docker Hub after successful testing."><meta name=application-name content="Shan's World"><meta name=apple-mobile-web-app-title content="Shan's World"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/><link rel=prev href=https://shantanoo-desai.github.io/posts/technology/iot_edge_docker/><link rel=next href=https://shantanoo-desai.github.io/posts/quotes/idleness/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CI/CD Notes: Nest.JS + TravisCI + Docker","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/nestjs_travis_docker\/"},"genre":"posts","keywords":"NestJS, Travis-CI, Docker, Continuous Integration","wordcount":744,"url":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/nestjs_travis_docker\/","datePublished":"2020-04-25T18:00:00+02:00","dateModified":"2020-04-25T18:00:00+02:00","publisher":{"@type":"Organization","name":"Shan"},"author":{"@type":"Person","name":"Shan"},"description":"A quick blog on how to make Travis CI push your App's Docker Image to Docker Hub after successful testing."}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/now title="What am I currently focusing on">Now </a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/ title="Everything You wish to know about me">About </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/now title="What am I currently focusing on">Now</a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/ title="Everything You wish to know about me">About</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">CI/CD Notes: Nest.JS + TravisCI + Docker</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Shan</a></span>&nbsp;<span class=post-category>included in <a href=/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=25-04-2020>25-04-2020</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;744 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#learning-material>Learning Material</a></li><li><a href=#continuous-integration-docker>Continuous Integration +Â Docker</a><ul><li><a href=#travis-ci-configuration>Travis-CI Configuration</a></li><li><a href=#the-gotcha-for-dockerhub>The Gotcha for DockerÂ Hub</a></li><li><a href=#configuration-file>Configuration File</a></li></ul></li><li><a href=#resources>Resources</a></li></ul></nav></div></div><div class=content id=content><h2 id=overview>Overview</h2><p>I recently got into <a href=https://nestjs.com target=_blank rel="noopener noreffer">Nest.JS</a> as a Backend framework and found it more comfortable since I have worked with <a href=https://angular.io target=_blank rel="noopener noreffer">Angular</a> for a couple of years now. So I wanted to learn the framework a bit more than your usual Beginners Tutorial.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>I am not going to dive deep into how to write Unit Tests (I am not a champ) or how to use Travis CI, but at some point it might be easier to let some automation take over your software tasks.</div></div></div><h2 id=learning-material>Learning Material</h2><ul><li>I used the Academind &lsquo;s YouTube Tutorial of Nest.JS + MongoDB to create a CRUD App for my MongoDB Atlas Cluster.</li></ul><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/ulfU5vY6I78 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><ul><li>I stumbled upon a really good <a href=https://github.com/jmcdo29/testing-nestjs target=_blank rel="noopener noreffer">GitHub Repository from Jay McDonial</a> called <code>testing-nestjs</code>Â . It served as a reference to write Tests for my <code>ProductsComponent</code></li></ul><h2 id=continuous-integration-docker>Continuous Integration +Â Docker</h2><p>I had some idea of using Travis-CI previous as a tool to conduct tests for code-bases but never found time to dive deep into it.</p><p>Docker has been a hot ðŸ”¥ tool around for a while and I decided upon integrating Travis and Docker with a simple aim:</p><blockquote><p>Once the tests for the API pass, build a Docker image and push it to a Docker registry.</p></blockquote><h3 id=travis-ci-configuration>Travis-CI Configuration</h3><p>At first glance <a href=https://travis-ci.org target=_blank rel="noopener noreffer">Travis CI</a> already had documentation for <a href="https://medium.com/r/?url=https%3A%2F%2Fdocs.travis-ci.com%2Fuser%2Fdocker" target=_blank rel="noopener noreffer">Docker integration</a> and how to leverage <a href="https://medium.com/r/?url=https%3A%2F%2Fdocs.travis-ci.com%2Fuser%2Fdocker%2F%23pushing-a-docker-image-to-a-registry" target=_blank rel="noopener noreffer">Travis for Pushing Docker Images to a Registry</a> which made it a tad bit easy.</p><p>However if you need to push a Docker Image to a registry you need to have a username and password or similar credentials. Exposing such credentials within a file is something one needs to avoid at all costs.</p><p>However, there is a way to pass important environment variables without having to mention them within the code base.</p><h4 id=credential-setup>Credential Setup</h4><p>Follow these steps:</p><ol><li>You simply create a Travis-CI Build Project for your GitHub repository and click on <strong>More Options</strong></li></ol><figure><img src=/images/technology/travisci_nestjs/travis_build_project.png><figcaption><h4>Travis-CI Build Project Snippet for the Github Project</h4></figcaption></figure><ol start=2><li>Navigate to <strong>Settings</strong> and find the <strong>Environment Variables</strong> section</li></ol><figure><img src=/images/technology/travisci_nestjs/travis_env_var_section.png><figcaption><h4>Environment Variables Section in Project Settings</h4></figcaption></figure><ol start=3><li>Add your Docker Hub&rsquo;s Credentials here i.e. <code>DOCKER_USERNAME</code> and <code>DOCKER_PASSWORD</code></li></ol><figure><img src=/images/technology/travisci_nestjs/creds_travisci.png><figcaption><h4>Docker Credentials stored as environment variables for every Travis CIÂ build</h4></figcaption></figure><h3 id=the-gotcha-for-dockerhub>The Gotcha for DockerÂ Hub</h3><p>It is easy to be fooled by assuming that our Docker Hub&rsquo;s password would be the same as we often use to login into the Hub&rsquo;s Website. However, that was not the case for me. Although I had added my Docker Hub&rsquo;s password within the respective environment variable <code>DOCKER_PASSWORD</code> I was still getting Access Denial upon pushing the Docker Image for my App.</p><p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Example: <a href="https://medium.com/r/?url=https%3A%2F%2Ftravis-ci.org%2Fgithub%2Fshantanoo-desai%2Fnestjs-products-api%2Fjobs%2F679150053%23L319" target=_blank rel="noopener noreffer">Build #14 for the project</a></div></div></div><figure><img src=/images/technology/travisci_nestjs/travis_build_failure_log.png><figcaption><h4>Build Log which threw Access Denied from the DockerÂ Hub</h4></figcaption></figure></p><p><em>It took me a while to figure out that Docker Hub usually will accept an <strong>Accept Token</strong> as an accepted form of credential.</em></p><h4 id=access-tokens-from-dockerhub>Access Tokens from DockerÂ Hub</h4><ol><li><p>Navigate to your Docker Hub account on <a href=https://hub.docker.com target=_blank rel="noopener noreffer">hub.docker.com</a></p></li><li><p>On the top right corner click on the <strong>User Account</strong> and navigate to <strong>Account Settings</strong></p></li><li><p>Navigate to <strong>Security</strong> and click on <strong>Generate Access Token</strong></p></li><li><p>Make sure to copy the generated Access Token within your Travis-CI Environment Variables Section for <code>DOCKER_PASSWORD</code></p></li></ol><p>This should now make all your Travis CI builds capable to push your Docker Images to a Registry.</p><h3 id=configuration-file>Configuration File</h3><p>Travis CI file are written in YAML and are typically calledÂ <code>.travis.yml</code></p><p>Here is mine:</p><script type=application/javascript src=https://gist.github.com/shantanoo-desai/c175e2e60474298efb38ae19d2543ba0.js></script><ul><li><p>The <code>after_sucess</code> tells Travis then once my NestJS tests are successful, build the Docker Image</p></li><li><p>The <code>before_deploy</code> stage tells Travis to log into the Registry. The commands within such stages are written as elements within a list for step-by-step execution. If you wish to publish your Image to Docker Hub make sure to use:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker login -u <span class=s2>&#34;</span><span class=nv>$DOCKER_USERNAME</span><span class=s2>&#34;</span> -p <span class=s2>&#34;</span><span class=nv>$DOCKER_PASSWORD</span><span class=s2>&#34;</span> docker.io
</code></pre></div></li><li><p>If for any other Registry change the server name in the end.</p></li><li><p>Restart your Travis Build or commit something to the repository to trigger a fresh new build.</p></li><li><p>Check your Docker Hub if a new Docker Image has been pushed by Travis CI.</p></li></ul><p>There you go! ðŸŽŠ Your first CI-CD DIY project.
Don&rsquo;t forget to add the cool Travis-CI Build Status to your Repository&rsquo;s README.md to flash your passing Builds.</p><p>I am not a purist so the Continuous Delivery part of pushing an Image to the Registry makes me happy. Plus, I am planning to learn how to handle deployment on Clouds so I guess I would be spared by the DevOps Lords in the Software universe.</p><h2 id=resources>Resources</h2><ul><li><a href=https://github.com/shantanoo-desai/nestjs-products-api target=_blank rel="noopener noreffer">GitHub Repository for <code>nestjs-products-api</code></a></li><li><a href=https://travis-ci.org/github/shantanoo-desai/nestjs-products-api target=_blank rel="noopener noreffer">Travis-CI Project for <code>nestjs-products-api</code></a></li><li><a href=https://hub.docker.com/repository/docker/shantanoodesai/nestjs-products-api target=_blank rel="noopener noreffer">Docker Hub Image for <code>nestjs-products-api</code></a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 25-04-2020</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/ data-title="CI/CD Notes: Nest.JS + TravisCI + Docker" data-hashtags="NestJS,Travis-CI,Docker,Continuous Integration"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/ data-hashtag=NestJS><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/ data-title="CI/CD Notes: Nest.JS + TravisCI + Docker" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/ data-title="CI/CD Notes: Nest.JS + TravisCI + Docker"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://shantanoo-desai.github.io/posts/technology/nestjs_travis_docker/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/nestjs/>NestJS</a>,&nbsp;<a href=/tags/travis-ci/>Travis-CI</a>,&nbsp;<a href=/tags/docker/>docker</a>,&nbsp;<a href=/tags/continuous-integration/>Continuous Integration</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/technology/iot_edge_docker/ class=prev rel=prev title="Creating your IoT Node and Edge prototype with InfluxDB, Telegraf and Docker"><i class="fas fa-angle-left fa-fw"></i>Creating your IoT Node and Edge prototype with InfluxDB, Telegraf and Docker</a>
<a href=/posts/quotes/idleness/ class=next rel=next title="On Idleness">On Idleness<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.70.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>