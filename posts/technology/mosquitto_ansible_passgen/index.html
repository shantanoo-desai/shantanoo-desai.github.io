<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Generating Mosquitto MQTT Broker Credentials with Ansible - Shan's Corner</title><meta name=Description content="Shan's World"><meta property="og:title" content="Generating Mosquitto MQTT Broker Credentials with Ansible"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/"><meta property="article:published_time" content="2023-08-16T13:00:00+02:00"><meta property="article:modified_time" content="2023-08-16T13:00:00+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Generating Mosquitto MQTT Broker Credentials with Ansible"><meta name=twitter:description content><meta name=application-name content="Shan's World"><meta name=apple-mobile-web-app-title content="Shan's World"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/><link rel=prev href=https://shantanoo-desai.github.io/posts/technology/telegraf_deployment_strategies/><link rel=next href=https://shantanoo-desai.github.io/posts/technology/mosquitto-fwd-compatibility-docker/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Generating Mosquitto MQTT Broker Credentials with Ansible","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/mosquitto_ansible_passgen\/"},"genre":"posts","keywords":"devops, ansible, mosquitto, mqtt, jinja2, python3, IIoT, IoT","wordcount":1419,"url":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/mosquitto_ansible_passgen\/","datePublished":"2023-08-16T13:00:00+02:00","dateModified":"2023-08-16T13:00:00+02:00","publisher":{"@type":"Organization","name":"Shan"},"author":{"@type":"Person","name":"Shan"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/now title="What am I currently focusing on">Now </a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/ title="Everything You wish to know about me">About </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/now title="What am I currently focusing on">Now</a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/ title="Everything You wish to know about me">About</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Generating Mosquitto MQTT Broker Credentials with Ansible</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Shan</a></span>&nbsp;<span class=post-category>included in <a href=/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=16-08-2023>16-08-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1419 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#challenge>Challenge</a></li><li><a href=#mosquitto-brokers-credentials-generation>Mosquitto Broker&rsquo;s Credentials Generation</a><ul><li><a href=#mosquitto_passwd-cli-native><code>mosquitto_passwd</code> CLI native</a></li><li><a href=#mosquitto_passwd-cli-via-docker-container><code>mosquitto_passwd</code> CLI via Docker Container</a></li></ul></li><li><a href=#independent-credential-generation-for-broker>Independent Credential Generation for Broker</a><ul><li><a href=#templates-for-password-file>Templates for Password File</a></li><li><a href=#custom-jinja2-filter-for-hash-generation>Custom Jinja2 Filter for Hash Generation</a></li></ul></li><li><a href=#results>Results</a><ul><li><a href=#verifying-with-the-broker>Verifying with the Broker</a></li></ul></li><li><a href=#potential-extensions>Potential Extensions</a></li></ul></nav></div></div><div class=content id=content><h2 id=challenge>Challenge</h2><p>This is a development note from a personal, open-source project called <a href=https://github.com/shantanoo-desai/komponist target=_blank rel="noopener noreffer"><strong>Komponist</strong></a>.
The aim of the project is to provide IoT / IIoT Developers a platform that can be used locally as well as in production using commonly used containers
in the Edge computing space such as:</p><ul><li>Time-series Databases (InfluxDBv1/v2, QuestDB, TimescaleDB)</li><li>Data processing tools (Node-RED, Telegraf)</li><li>Dashboard visualization / monitoring (Grafana)</li><li>Message Broker (Eclipse-Mosquitto)
There are standard tools / software used quite ubiquitously with containerization technology like <strong>Docker / Compose v2</strong>.</li></ul><p>One major challenge that developers face is to maintain a lot of files that are needed to bring these tools / software up on initialization.
These files mostly contain user credentials, initialization scripts and configurations needed to start these containers correctly and according to user specifications.
Additionally, each container of these tools / software are very distinct and may rely on various setups, markup languages (YAML, TOML, INI) etc.
and there is rarely any coherence available between one tool against the other.</p><p>Komponist solves this issue by add a logical configuration generation tool over the tools and relies only on two core files
that describes the complete stack along side the respective credentials and configurations.
It uses the easy to use <code>ansible</code> configuration management tool to generate the respective docker-compose files, credentials file, YAML and TOML files for the software
and prepares the stack within a couple of minutes either locally or within a group of IoT edge devices.</p><p>This writeup focuses more on the Mosquitto MQTT Broker. The writeup describes how to leverage Ansible and Jinja2 powered Templating engine to generate Mosquitto Broker&rsquo;s
credentials.</p><p>NOTE: This writeup requires some basic to intermediate knowledge of <a href=https://ansible.com target=_blank rel="noopener noreffer">Ansible</a> as a tool.</p><h2 id=mosquitto-brokers-credentials-generation>Mosquitto Broker&rsquo;s Credentials Generation</h2><h3 id=mosquitto_passwd-cli-native><code>mosquitto_passwd</code> CLI native</h3><p>According to the <a href=https://mosquitto.org/man/mosquitto_passwd-1.html target=_blank rel="noopener noreffer">mosquitto broker&rsquo;s authentication methods documentation</a>
it is possible to generate password files when one either has the <code>mosquitto_passwd</code> CLI installed locally / remotely on the IoT devices.
For example, the following plain-text <code>passwd.txt</code> file:</p><pre><code>user1:superSecretPass1
user2:superSecretPass2
</code></pre><p>will encrypt the plain-text passwords into hashes that are acceptable by the mosquitto broker via the <code>mosquitto-passwd</code> CLI using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mosquitto_passwd -U /path/to/passwd.txt
</code></pre></div><p>However, it relies on the existence of <code>mosquitto_passwd</code> tool to be available locally.</p><h3 id=mosquitto_passwd-cli-via-docker-container><code>mosquitto_passwd</code> CLI via Docker Container</h3><p>The same tool can be used via a Docker container where the plain-text password <code>passwd.txt</code> file can be encrypted via spinning a docker container
locally and mounting the plain-text file to a dedicated path into it. An example with the same <code>passwd.txt</code> can be:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker run --rm -v /path/to/passwd.txt:/mosquitto/config/users <span class=se>\
</span><span class=se></span>eclipse-mosquitto:2.0.15 <span class=se>\
</span><span class=se></span>mosquitto_passwd -U /mosquitto/config/users
</code></pre></div><p>Since the file is mounted into the container, any changes within the container will be reflected on the <code>passwd.txt</code> on the host i.e., the plain-text passwords will be encrypted accordingly.</p><blockquote><p>Both these methods, require dependency on either the <code>mosquitto_passwd</code> CLI or the <code>eclipse-mosquitto</code> Docker Image to exist locally beforehand.</p></blockquote><h2 id=independent-credential-generation-for-broker>Independent Credential Generation for Broker</h2><p>Upon observing the code base for <a href=https://github.com/eclipse/mosquitto/blob/master/src/password_mosq.h target=_blank rel="noopener noreffer">eclipse/mosquitto</a> it turns out the password hash generation relies on two methods:</p><ol><li>SHA512 + additional salting and base64 encryption logic</li><li>SHA512 type PBKDF2 encryption logic</li></ol><p>The details of the these two methods are beyond the scope of the write up but the implementations for them are quite common and can be found in every programming language.</p><p>Since <strong>Komponist</strong> relies on Ansible and Jinja2 templating engine which are directly reliant on Python3.x as a programming language, the implementation is rather trivial thanks to <a href=https://passlib.readthedocs.io/en/stable/index.html target=_blank rel="noopener noreffer"><code>passlib</code></a> python package.
<code>passlib</code> provides the implementation of <strong>PBKDF2_SHA512</strong> logic with all the necessary encoding logic needed for the hashing of plain-text passwords that are acceptable by the Broker.</p><h3 id=templates-for-password-file>Templates for Password File</h3><p>As previously seen a <code>passwd.txt</code> an acceptable structure is:</p><pre><code>user1:password1
user2:password2
userN:passwordN
</code></pre><p>A <code>users.j2</code> template file can be created as follows:</p><pre><code class=language-jinja2 data-lang=jinja2>{%- for user in mosquitto.users %}
{{ user.username }}:{{ user.password }}
{% endfor %}
</code></pre><p>where the <code>mosquitto.users</code> is an array of dictionaries:</p><pre><code>mosquitto:
  users:
    - username: user1
      password: password1
    - username: user2
      password: password2
</code></pre><p>To test this logic we can create an Ansible Playbook called <code>mosquitto_users.yml</code> as follows:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Mosquitto<span class=w> </span>Users<span class=w> </span>(plain-text)<span class=w> </span>file<span class=w> </span>generation<span class=w>
</span><span class=w>  </span><span class=k>hosts</span><span class=p>:</span><span class=w> </span>localhost<span class=w>
</span><span class=w>  </span><span class=k>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>  </span><span class=k>vars</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>mosquitto</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>users</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=k>username</span><span class=p>:</span><span class=w> </span>testuser1<span class=w>
</span><span class=w>          </span><span class=k>password</span><span class=p>:</span><span class=w> </span>password1<span class=w>
</span><span class=w>        </span>- <span class=k>username</span><span class=p>:</span><span class=w> </span>testuser2<span class=w>
</span><span class=w>          </span><span class=k>password</span><span class=p>:</span><span class=w> </span>password2<span class=w>
</span><span class=w>
</span><span class=w>  </span><span class=k>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>generate<span class=w> </span>the<span class=w> </span>Mosquitto<span class=w> </span>users<span class=w> </span>file<span class=w>
</span><span class=w>      </span><span class=k>ansible.builtin.template</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>src</span><span class=p>:</span><span class=w> </span>users.j2<span class=w>
</span><span class=w>        </span><span class=k>dest</span><span class=p>:</span><span class=w> </span>users<span class=w>
</span></code></pre></div><p>Execute the playbook using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ tree
├── mosquitto_users.yml
└── users.j2
$ ansible-playbook mosquitto_users.yml
</code></pre></div><p>upon execution of the playbook a <code>users</code> file will be generated that will fill the values of the credentials accordingly.</p><h3 id=custom-jinja2-filter-for-hash-generation>Custom Jinja2 Filter for Hash Generation</h3><p>The template file <code>users.j2</code> currently fulfills the criteria of structure required for the Broker.
We now create a custom Jinja2 filter that will consume the plain-text passwords and generate the acceptable hashes for the Broker.</p><p>A Jinja2 filter in Ansible is rather a very simple python script that Ansible executes to generate the respective logic.
As previously mentioned, we know that <code>passlib</code> library provides a <a href=https://passlib.readthedocs.io/en/stable/lib/passlib.hash.pbkdf2_digest.html target=_blank rel="noopener noreffer"><strong>PBKDF2_SHA512</strong>_</a>
implementation and upon inspecting the code base for eclipse mosquitto we can also determine how many rounds(iterations) are required and what the salt length should be.
The values are as follows:</p><ol><li>Iterations are 101</li><li>salt length is 12 bytes (random bytes)
Based on the <code>passlib</code> API this information can be passed into a function call rather easily.</li></ol><p>Let&rsquo;s call the filter the same as <code>mosquitto_passwd</code> . Here is the implementation:</p><ol><li>Create a folder called <code>filter_plugins</code> and create <code>mosquitto_passwd.py</code> under it</li><li>install the <code>passlib</code> package using <code>pip install --user passlib</code></li><li>Add the following code into the <code>mosquitto_passwd.py</code></li></ol><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>ansible.errors</span> <span class=kn>import</span> <span class=n>AnsibleError</span>

<span class=k>def</span> <span class=nf>mosquitto_passwd</span><span class=p>(</span><span class=n>passwd</span><span class=p>):</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=kn>import</span> <span class=nn>passlib.hash</span>
    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
        <span class=k>raise</span> <span class=n>AnsibleError</span><span class=p>(</span><span class=s1>&#39;mosquitto_passlib custom filter requires the passlib pip package installed&#39;</span><span class=p>)</span>
    
    <span class=n>SALT_SIZE</span> <span class=o>=</span> <span class=mi>12</span>
    <span class=n>ITERATIONS</span> <span class=o>=</span> <span class=mi>101</span>

    <span class=n>digest</span> <span class=o>=</span> <span class=n>passlib</span><span class=o>.</span><span class=n>hash</span><span class=o>.</span><span class=n>pbkdf2_sha512</span><span class=o>.</span><span class=n>using</span><span class=p>(</span><span class=n>salt_size</span><span class=o>=</span><span class=n>SALT_SIZE</span><span class=p>,</span> <span class=n>rounds</span><span class=o>=</span><span class=n>ITERATIONS</span><span class=p>)</span> \
                                        <span class=o>.</span><span class=n>hash</span><span class=p>(</span><span class=n>passwd</span><span class=p>)</span> \
                                        <span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;pbkdf2-sha512&#34;</span><span class=p>,</span> <span class=s2>&#34;7&#34;</span><span class=p>)</span> \
                                        <span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=s2>&#34;+&#34;</span><span class=p>)</span>
    
    <span class=k>return</span> <span class=n>digest</span> <span class=o>+</span> <span class=s2>&#34;==&#34;</span>


<span class=k>class</span> <span class=nc>FilterModule</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>filters</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=p>{</span>
            <span class=s1>&#39;mosquitto_passwd&#39;</span><span class=p>:</span> <span class=n>mosquitto_passwd</span><span class=p>,</span>
        <span class=p>}</span>   
</code></pre></div><p>Few things to note in the implementation:</p><ul><li>Hash digest generated by <code>passlib.hash.pbkdf2_sha512</code> is the of the following structure:
<code>$pbkdf2-sha256$6400$0ZrzXitFSGltTQnBWOsdAw$Y11AchqV4b0sUisdZd0Xr97KWoymNE0LNNrnEgY4H9M</code></li><li>Mosquitto Broker requires that the first part of the digest either be <code>7</code> for PBKDF2_SHA512 or <code>6</code> for the SHA-512. This is done by the <code>.replace("pbkdf2_sha512", "7")</code> in the code</li><li><code>passlib</code> PBKDF2_SHA512 implementation has a <a href=https://passlib.readthedocs.io/en/stable/lib/passlib.utils.binary.html#passlib.utils.binary.ab64_encode target=_blank rel="noopener noreffer">shortened base64 format</a> which omits padding and whitespaces, which will not be acceptable by the Broker.
In order to make the digest compatible we replace the instances of <code>.</code> with <code>+</code> in the digest (via <code>.replace(".", "+")</code>)</li><li>we add the <code>==</code> characters at the end of the digest to make up for the shortened base64 encoding implementation when it comes to the overall length of the digest</li></ul><p>The final step should is to add the custom <code>mosquitto_passwd</code> filter into our <code>users.j2</code> file as follows:</p><pre><code class=language-jinja2 data-lang=jinja2>{%- for user in mosquitto.users %}
{{ user.username }}:{{ user.password | mosquitto_passwd }}
{% endfor %}
</code></pre><p>the template during generation will pass the <code>user.password</code> to the <code>mosquitto_passwd</code> filter and provide the hashed value as opposed to the plain-text values in a <code>users</code> file.</p><h2 id=results>Results</h2><p>For the following structure:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ tree .
.
├── filter_plugins
│   └── mosquitto_passwd.py
├── mosquitto_users.yml
└── users.j2
</code></pre></div><p>executing the playbook <code>mosquitto_users.yml</code>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ansible-playbook mosquitto_users.yml
</code></pre></div><p>will generate a <code>users</code> file in the directory. Upon viewing the contents of the file:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>cat users
testuser1:<span class=nv>$7$101$9</span>h4jJKT0HiMEgDAm<span class=nv>$3</span>ynyYne/t4KJyjDqOyCVzF0G0Oa71nu0K9iaa1NNfzCNc5c71iVnUVqV+zxDjGkaDy6gSAWAyk6KmqgTaE1IDQ<span class=o>==</span>
testuser2:<span class=nv>$7$101$HwNAKGVsjbE2JkRI$Nk</span>+xnkjOTyllT7hD4N5kd9kGarMAQJMJVgWraa0VxmKZgyRyfUjG0+kUCPE1ZuLaGPrbeq0H80Pl6tHd+Qm2Lw<span class=o>==</span>
</code></pre></div><p>(password hashes may vary, since salt lengths are randomly generated)</p><h3 id=verifying-with-the-broker>Verifying with the Broker</h3><p>The best way to confirm that the hashes are acceptable is to generate a <code>mosquitto.conf</code> file with the following contents:</p><pre><code># MQTT Port Listener
listener    1883
protocol    mqtt

# Authentication
allow_anonymous     false
password_file       /mosquitto_users
</code></pre><p>and then using the following <code>docker-compose.yml</code> file:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>mosquitto</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>docker.io/eclipse-mosquitto<span class=p>:</span><span class=m>2.0.15</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test_broker<span class=w>
</span><span class=w>    </span><span class=k>configs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- mosquitto_conf<span class=w>
</span><span class=w>      </span>- mosquitto_users<span class=w>
</span><span class=w>    </span><span class=k>entrypoint</span><span class=p>:</span><span class=w> </span>mosquitto<span class=w> </span>-c<span class=w> </span>/mosquitto_conf<span class=w>
</span><span class=w>    </span><span class=k>ports</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=m>1883</span><span class=p>:</span><span class=m>1883</span><span class=w>
</span><span class=w></span><span class=k>configs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>mosquitto_conf</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>file</span><span class=p>:</span><span class=w> </span>./mosquitto.conf<span class=w>
</span><span class=w>  </span><span class=k>mosquitto_users</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>file</span><span class=p>:</span><span class=w> </span>./users<span class=w>
</span></code></pre></div><p>upon performing:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker compose up
</code></pre></div><p>You will be able to see the logs of the broker without any erroneous information:</p><pre><code>test_broker  | 1692181531: mosquitto version 2.0.15 starting
test_broker  | 1692181531: Config loaded from /mosquitto_conf.
test_broker  | 1692181531: Opening ipv4 listen socket on port 1883.
test_broker  | 1692181531: Opening ipv6 listen socket on port 1883.
test_broker  | 1692181531: mosquitto version 2.0.15 running
</code></pre><p>Use an MQTT client and try to connect to the broker <code>&lt;IP_ADDRESS>:1883</code> with either of the credentials values mentioned in <code>mosquitto.users</code> and it should work.</p><p>Now you have a functioning configuration management tool for your eclipse Mosquitto Broker using a popular DevOps / Configuration Management Tool (Ansible)
which provides you a guarantee of authentication without having any Mosquitto related software installed beforehand on your IoT Devices / Servers / Industrial Hardware.</p><h2 id=potential-extensions>Potential Extensions</h2><p>You can now generate Jinja2 based template files for the Access-Control Lists (ACLs) or other related configurations with having to maintain multiple versions of them rather let Ansible generate them for you.</p><p>Similar, logic has been developed for <a href=https://github.com/shantanoo-desai/komponist target=_blank rel="noopener noreffer"><em>Komponist</em></a>
where a user can define how many users and what ACL permissions each user has on topics by just maintaining a single credentials file for the Mosquitto Broker as well as other containers such as InfluxDB, node-RED etc.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 16-08-2023</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/ data-title="Generating Mosquitto MQTT Broker Credentials with Ansible" data-hashtags=devops,ansible,mosquitto,mqtt,jinja2,python3,IIoT,IoT><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/ data-hashtag=devops><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/ data-title="Generating Mosquitto MQTT Broker Credentials with Ansible" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/ data-title="Generating Mosquitto MQTT Broker Credentials with Ansible"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://shantanoo-desai.github.io/posts/technology/mosquitto_ansible_passgen/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/devops/>DevOps</a>,&nbsp;<a href=/tags/ansible/>ansible</a>,&nbsp;<a href=/tags/mosquitto/>mosquitto</a>,&nbsp;<a href=/tags/mqtt/>MQTT</a>,&nbsp;<a href=/tags/jinja2/>jinja2</a>,&nbsp;<a href=/tags/python3/>python3</a>,&nbsp;<a href=/tags/iiot/>IIoT</a>,&nbsp;<a href=/tags/iot/>IoT</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/technology/telegraf_deployment_strategies/ class=prev rel=prev title="Telegraf Deployment Strategies with Docker Compose"><i class="fas fa-angle-left fa-fw"></i>Telegraf Deployment Strategies with Docker Compose</a>
<a href=/posts/technology/mosquitto-fwd-compatibility-docker/ class=next rel=next title="Forward Compatibility for Mosquitto MQTT Broker with Docker Compose v2">Forward Compatibility for Mosquitto MQTT Broker with Docker Compose v2<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.70.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>