<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables - Shan's Corner</title><meta name=Description content="Shan's World"><meta property="og:title" content="Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/"><meta property="article:published_time" content="2022-07-15T16:53:18+02:00"><meta property="article:modified_time" content="2022-07-15T16:53:18+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables"><meta name=twitter:description content><meta name=application-name content="Shan's World"><meta name=apple-mobile-web-app-title content="Shan's World"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/><link rel=prev href=https://shantanoo-desai.github.io/posts/technology/multi-image-docker-image/><link rel=next href=https://shantanoo-desai.github.io/posts/technology/packer-ubuntu-qemu/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/compose-incompatibility\/"},"genre":"posts","keywords":"docker, docker-compose, vagrant, ansible, DevOps","wordcount":1091,"url":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/compose-incompatibility\/","datePublished":"2022-07-15T16:53:18+02:00","dateModified":"2022-07-15T16:53:18+02:00","publisher":{"@type":"Organization","name":"Shan"},"author":{"@type":"Person","name":"Shan"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/now title="What am I currently focusing on">Now </a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/ title="Everything You wish to know about me">About </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/now title="What am I currently focusing on">Now</a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/ title="Everything You wish to know about me">About</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Shan</a></span>&nbsp;<span class=post-category>included in <a href=/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=15-07-2022>15-07-2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1091 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#problem>Problem</a><ul><li><a href=#compose-v2-what-changes>Compose V2: what changes?</a></li></ul></li><li><a href=#swiss-knife-for-the-exploration>Swiss Knife for the Exploration</a><ul><li><a href=#vagrant>Vagrant</a></li><li><a href=#ansible>Ansible</a></li></ul></li><li><a href=#why-are-we-doing-this>Why are we doing this?</a><ul><li><a href=#node-red-container>Node-RED Container</a></li></ul></li><li><a href=#code>Code</a><ul><li><a href=#vagrantfile><code>Vagrantfile</code></a></li><li><a href=#ansible-playbook-docker-compose-playbookyml>Ansible Playbook: <code>docker-compose-playbook.yml</code></a></li><li><a href=#files-for-reproduction-of-incompatibility>Files for reproduction of incompatibility</a></li></ul></li><li><a href=#compatibility-checks>Compatibility Checks</a><ul><li><a href=#checks-password-not-enclosed-in-single-quotes>Checks: Password not enclosed in Single Quotes</a></li><li><a href=#checks-password-enclosed-in-single-quotes>Checks: Password enclosed in single quotes</a></li><li><a href=#compose-v1292-with-single-quotes>Compose v1.29.2 (with single quotes)</a></li><li><a href=#compose-v2-with-single-quotes>Compose v2 (with single quotes)</a></li></ul></li><li><a href=#result-compose-compatibility-matrix>Result: Compose Compatibility Matrix</a><ul><li><a href=#what-did-we-learn-today-kids>What did we learn today, kids?</a></li><li><a href=#github-gist>Github Gist</a></li></ul></li><li><a href=#feedback>Feedback</a></li></ul></nav></div></div><div class=content id=content><h2 id=problem>Problem</h2><p>Since <a href=https://www.docker.com/blog/announcing-compose-v2-general-availability/ target=_blank rel="noopener noreffer">Docker&rsquo;s Compose V2 General Availability</a> announcement, a lot of things have changed which might lead to
Incompatibility in your currently running application stacks.</p><h3 id=compose-v2-what-changes>Compose V2: what changes?</h3><ul><li>instead of <code>docker-compose</code> the syntax will be <code>docker compose</code></li><li><code>docker-compose</code> (v1) was written in Python, <code>docker compose</code> (v2) is in Go</li><li>Compose V1 is official EOL (End Of Life) aka. Deprecated</li></ul><p>There are lot of fine things in Compose V2 but this post isn&rsquo;t about it. This write-up takes you through the murky
marshland between Compose V1 and Compose V2 and how things might start you break when you decide to jump to the
<em>cool V2</em> version without doing some thorough checks in your stack application</p><h2 id=swiss-knife-for-the-exploration>Swiss Knife for the Exploration</h2><p>Tools you will need:</p><ul><li><strong>Hashicorp Vagrant</strong></li><li><strong>Ansible</strong></li><li><strong>Different versions of Docker Compose (v1 as well as v2)</strong></li></ul><h3 id=vagrant>Vagrant</h3><p>Instead of setting up a pain-staking Virtual Machine, we will leverage a bit simplified and inexpensive Vagrant Machine
with <strong>Ubuntu 20.04 (focal amd64) base image</strong>.</p><p>Within this image we will install the following:</p><ul><li>Docker Engine <code>20.10.17</code></li><li>Docker Compose v1: <code>v1.25.4 build 8d51620a</code> and <code>v1.29.2 build 5b3cea4c</code></li><li>Docker Compose v2: <code>2.6.0</code></li></ul><h3 id=ansible>Ansible</h3><p>I have Ansible installed on my host machine</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ansible --version
ansible <span class=o>[</span>core 2.13.1<span class=o>]</span>
</code></pre></div><p>Ansible will install all the spicy Compose versions into the Vagrant Machine for us</p><h2 id=why-are-we-doing-this>Why are we doing this?</h2><p>If you have containers that require passwords at rest e.g. in <code>.env</code> environment files to be encrypted and with
special characters like the <code>$</code> in them, we are going for ride which will make you want to bookmark this write-up.</p><p>It turns out, I had a system running Compose v1 (<code>v1.25.4</code>) and upon upgrading to Compose v2 (<code>2.6.0</code>) I wasn&rsquo;t able
to login to my Node-RED container which had authentication setup already.</p><h3 id=node-red-container>Node-RED Container</h3><p>Node-RED requires that the administrator password must be encrypted in <code>bcrypt</code> type scheme and the password looks
something like your dog walked over your keyboard.</p><pre><code>$2a$08$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.
</code></pre><p>This looks fairly okay, but the menace is the <code>$</code> characters in them.</p><p>Let&rsquo;s dive deep shall we!</p><h2 id=code>Code</h2><h3 id=vagrantfile><code>Vagrantfile</code></h3><p>I am using a Linux Machine with Virtual Box as a provider</p><pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :


Vagrant.configure(&quot;2&quot;) do |config|
  
  # Use Ubuntu 20.04 as base
  config.vm.box = &quot;ubuntu/focal64&quot;

  config.vm.box_check_update =false

  # Synchronize all the docker-compose related file to `/vagrant` dir in VM
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;

  config.vm.provider &quot;virtualbox&quot; do |vb|
    vb.memory = &quot;2048&quot;
  end

  # Setup the VM with all the different variants of Docker Compose in them
  config.vm.provision &quot;ansible&quot; do |a|
    a.verbose = &quot;v&quot;
    a.playbook = &quot;./docker-compose-playbook.yml&quot;
  end
end
</code></pre><h3 id=ansible-playbook-docker-compose-playbookyml>Ansible Playbook: <code>docker-compose-playbook.yml</code></h3><p>We will let Ansible install all the required Docker Compose versions for us in the VM through the playbook.</p><ul><li>Docker Compose v1.25.4 will be available in the VM as CLI <code>docker-compose-125</code></li><li>Docker Compose v1.29.2 will be available in the VM as CLI <code>docker-compose-129</code></li><li>Docker Compose v2.6.0 will be available in the VM as CLI <code>docker compose</code></li></ul><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>---<span class=w>
</span><span class=w></span>- <span class=k>hosts</span><span class=p>:</span><span class=w> </span>all<span class=w>
</span><span class=w>  </span><span class=k>become</span><span class=p>:</span><span class=w> </span>yes<span class=w>
</span><span class=w>  </span><span class=k>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>install<span class=w> </span>prerequisites<span class=w>
</span><span class=w>      </span><span class=k>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>name</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- apt-transport-https<span class=w>
</span><span class=w>          </span>- ca-certificates<span class=w>
</span><span class=w>          </span>- curl<span class=w>
</span><span class=w>          </span>- gnupg-agent<span class=w>
</span><span class=w>          </span>- software-properties-common<span class=w>
</span><span class=w>        </span><span class=k>update_cache</span><span class=p>:</span><span class=w> </span>yes<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>add<span class=w> </span>apt-key<span class=w>
</span><span class=w>      </span><span class=k>apt_key</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>url</span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//download.docker.com/linux/ubuntu/gpg<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>add<span class=w> </span>docker<span class=w> </span>repo<span class=w>
</span><span class=w>      </span><span class=k>apt_repository</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>repo</span><span class=p>:</span><span class=w> </span>deb<span class=w> </span>https<span class=p>:</span>//download.docker.com/linux/ubuntu<span class=w> </span>focal<span class=w> </span>stable<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>install<span class=w> </span>docker<span class=w>
</span><span class=w>      </span><span class=k>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>name</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- docker-ce<span class=w>
</span><span class=w>          </span>- docker-ce-cli<span class=w>
</span><span class=w>          </span>- containerd.io<span class=w>
</span><span class=w>          </span>- docker-compose-plugin<span class=w>
</span><span class=w>        </span><span class=k>update_cache</span><span class=p>:</span><span class=w> </span>yes<span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>add<span class=w> </span>userpermissions<span class=w>
</span><span class=w>      </span><span class=k>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;usermod -aG docker vagrant&#34;</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>docker-compose<span class=w> </span>v1<span class=m>.29.2</span><span class=w> </span>from<span class=w> </span>official<span class=w> </span>github<span class=w> </span>repo<span class=w>
</span><span class=w>      </span><span class=k>get_url</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>url </span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//github.com/docker/compose/releases/download/<span class=m>1.29.2</span>/docker-compose-Linux-x86_64<span class=w>
</span><span class=w>        </span><span class=k>dest</span><span class=p>:</span><span class=w> </span>/usr/local/bin/docker-compose<span class=m>-129</span><span class=w>
</span><span class=w>        </span><span class=k>mode</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;u+x,g+x&#39;</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>change<span class=w> </span>compose<span class=w> </span>v1<span class=m>.29.2</span><span class=w> </span>user<span class=w> </span>permissions<span class=w>
</span><span class=w>      </span><span class=k>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;chmod +x /usr/local/bin/docker-compose-129&#34;</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>docker-compose<span class=w> </span>v1<span class=m>.25.4</span><span class=w> </span>from<span class=w> </span>official<span class=w> </span>github<span class=w> </span>repo<span class=w>
</span><span class=w>      </span><span class=k>get_url</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>url</span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//github.com/docker/compose/releases/download/<span class=m>1.25.4</span>/docker-compose-Linux-x86_64<span class=w>
</span><span class=w>        </span><span class=k>dest</span><span class=p>:</span><span class=w> </span>/usr/local/bin/docker-compose<span class=m>-125</span><span class=w>
</span><span class=w>        </span><span class=k>mode</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;u+x,g+x&#39;</span><span class=w>
</span><span class=w>    </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>change<span class=w> </span>compose<span class=w> </span>v1<span class=m>.25.4</span><span class=w> </span>user<span class=w> </span>permissions<span class=w>
</span><span class=w>      </span><span class=k>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;chmod +x /usr/local/bin/docker-compose-125&#34;</span><span class=w>
</span></code></pre></div><h3 id=files-for-reproduction-of-incompatibility>Files for reproduction of incompatibility</h3><p>We wont be spinning too much complex stuff so a simple compose file and the relevant <code>.env.node-red</code>
file with the encrypted password should suffice</p><h4 id=docker-composeyml><code>docker-compose.yml</code></h4><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.7&#39;</span><span class=w>
</span><span class=w></span><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>env_file</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- .env.node-red<span class=w>
</span></code></pre></div><h4 id=envnode-red><code>.env.node-red</code></h4><pre><code># Encrypting plain-text password with value `password` with bcyrpt
NODERED_ADMIN_PASSWORD=$2a$08$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.
</code></pre><h2 id=compatibility-checks>Compatibility Checks</h2><p>Let&rsquo;s bring the Vagrant Machine up using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vagrant up
</code></pre></div><p>this will download the base ubuntu image if you previously don&rsquo;t have it on your host machine,
provision it with all the docker compose versions in it.</p><p>Login into the Machine:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vagrant ssh
</code></pre></div><p>Once into the Machine head to the <code>/vagrant</code> directory, and just to be safe we check if all the
required compose versions are available or not.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>$ <span class=nb>cd</span> /vagrant

$ docker-compose-125 --version
$ docker-compose-129 --version
$ docker compose version
</code></pre></div><h3 id=checks-password-not-enclosed-in-single-quotes>Checks: Password not enclosed in Single Quotes</h3><p>As the <code>.env.node-red</code> file currently shows that my encrypted password is not enclosed in single quotes</p><p>Let&rsquo;s understand what Compose thinks of the value of the environment variable.</p><h4 id=compose-v1254-without-single-quotes>Compose v1.25.4 (without single quotes)</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker-compose-125 config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span>$$2a$$<span class=m>08</span>$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.<span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w></span><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.7&#39;</span><span class=w>
</span></code></pre></div><blockquote><p>NO Problem! My dollar characters are escaped by docker-compose. I can login with password <code>password</code></p></blockquote><h4 id=compose-v1292-without-single-quotes>Compose v1.29.2 (without single quotes)</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker-compose-129 config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span>$$2a$$<span class=m>08</span>$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.<span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w></span><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.7&#39;</span><span class=w>
</span></code></pre></div><blockquote><p>NO Problem! My dollar characters are escaped by docker-compose. I can login with password <code>password</code></p></blockquote><h4 id=compose-v2-without-single-quotes>Compose v2 (without single quotes)</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker compose config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>node-red-app<span class=w>
</span><span class=w></span><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span>a$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.<span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w>    </span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w></span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>default</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>name</span><span class=p>:</span><span class=w> </span>node-red-app_default<span class=w>
</span></code></pre></div><blockquote><p>Oh NO! What happened here? Password looks eaten up. The YAML file looks different too!</p></blockquote><h3 id=checks-password-enclosed-in-single-quotes>Checks: Password enclosed in single quotes</h3><p>Now let&rsquo;s enclose our encrypted password between single quotes, so our <code>.env.node-red</code> file
should look like:</p><pre><code>NODERED_ADMIN_PASSWORD='$2a$08$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.'
</code></pre><h4 id=compose-v1254-with-single-quotes>Compose v1.25.4 (with single quotes)</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker-compose-125 config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;&#39;$$2a$$08$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.&#39;&#39;&#39;</span><span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w></span><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.7&#39;</span><span class=w>
</span></code></pre></div><blockquote><p>Oh NO! Why are there more single quotes than expected. This is not going to let me login!</p></blockquote><h3 id=compose-v1292-with-single-quotes>Compose v1.29.2 (with single quotes)</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker-compose-129 config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span>$$2a$$<span class=m>08</span>$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.<span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w></span><span class=k>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.7&#39;</span><span class=w>
</span></code></pre></div><blockquote><p>NO problem! here this will work fine as the dollar characters are escaped safely by compose</p></blockquote><h3 id=compose-v2-with-single-quotes>Compose v2 (with single quotes)</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker compose config
</code></pre></div><p>produces</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>node-red-app<span class=w>
</span><span class=w></span><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>node-red</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>test-nodered<span class=w>
</span><span class=w>    </span><span class=k>environment</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>NODERED_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span>$$2a$$<span class=m>08</span>$$zZWtXTja0fB1pzD4sHCMyOCMYz2Z6dNbM6tl8sJogENOMcxWV9DN.<span class=w>
</span><span class=w>    </span><span class=k>image</span><span class=p>:</span><span class=w> </span>nodered/node-red<span class=p>:</span><span class=m>2.2.2</span><span class=w>
</span><span class=w>    </span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w></span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>default</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>name</span><span class=p>:</span><span class=w> </span>node-red-app_default<span class=w>
</span></code></pre></div><blockquote><p>NO Problem! Phew ! This will work just fine !</p></blockquote><h2 id=result-compose-compatibility-matrix>Result: Compose Compatibility Matrix</h2><table><thead><tr><th align=center>Compose Version / Values</th><th align=center><code>1.25.4</code></th><th align=center><code>1.29.2</code></th><th align=center><code>2.6.0</code></th></tr></thead><tbody><tr><td align=center>with Single Quotes</td><td align=center>:x:</td><td align=center>:white_check_mark:</td><td align=center>:white_check_mark:</td></tr><tr><td align=center>without Single Quotes</td><td align=center>:white_check_mark:</td><td align=center>:white_check_mark:</td><td align=center>:x:</td></tr></tbody></table><h3 id=what-did-we-learn-today-kids>What did we learn today, kids?</h3><p><strong>No Single Quotes</strong>:</p><ul><li>Docker Compose v1.25.4 was able to resolve special characters without having enclose them in single quotes</li><li>Docker Compose v1.29.2 will also work just fine for values not enclosed in single quotes</li><li>Docker Compose v2 will try to go hay-wire (try to resolve the value after the <code>$</code> sign) if you do not use values in single quotes</li></ul><p><strong>With Single Quotes</strong>:</p><ul><li><p>Docker Compose v1.25.4 will <em>literally</em> take things enclosed in single quotes as part of your environment variable and will
break your Container&rsquo;s Login logic</p></li><li><p>Docker Compose v1.29.2 will work well</p></li><li><p>Docker Compose v2 will work well</p></li></ul><p>In a nutshell</p><blockquote><p>DON&rsquo;T JUMP THE GUN, when moving from different V1 to V2 in Compose. Do some throrough research as well as experiments.</p></blockquote><p>Since Compose V1 is now deprecated, when transitioning to Compose V2 check all your environment variable files and if they require
special characters to be either enclosed in single quotes or not. Estimate your downtimes and conduct isolated tests when required.</p><p>Rule of thumb from Compose V2 onwards: <em>if it got some special char in them password, pack em between single quotes</em></p><p>but to each their own!</p><h3 id=github-gist>Github Gist</h3><p><a href=https://gist.github.com/shantanoo-desai/b5d971c533509fdf978f9e97e584b0d0 target=_blank rel="noopener noreffer">GitHub Gist available publicly</a></p><h2 id=feedback>Feedback</h2><p>If you have some feedback, suggestions, criticisms drop me an E-mail or a message on LinkedIn. I am very happy to help and improve myself.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 15-07-2022</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/ data-title="Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables" data-hashtags=docker,docker-compose,vagrant,ansible,DevOps><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/ data-title="Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/ data-title="Exploring the marshland Docker Compose versions with single quotes, special characters and environment variables"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://shantanoo-desai.github.io/posts/technology/compose-incompatibility/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/docker/>docker</a>,&nbsp;<a href=/tags/docker-compose/>docker-compose</a>,&nbsp;<a href=/tags/vagrant/>vagrant</a>,&nbsp;<a href=/tags/ansible/>ansible</a>,&nbsp;<a href=/tags/devops/>DevOps</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/technology/multi-image-docker-image/ class=prev rel=prev title="'Multi-Image' Docker Image"><i class="fas fa-angle-left fa-fw"></i>'Multi-Image' Docker Image</a>
<a href=/posts/technology/packer-ubuntu-qemu/ class=next rel=next title="Customized Ubuntu Images using Packer + QEMU + Cloud-Init & UEFI bootloading">Customized Ubuntu Images using Packer + QEMU + Cloud-Init & UEFI bootloading<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.70.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>