<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Seed Your MongoDB Container with JSON data using Docker and Docker-Compose - Shan's Corner</title><meta name=Description content="Shan's World"><meta property="og:title" content="Seed Your MongoDB Container with JSON data using Docker and Docker-Compose"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/"><meta property="article:published_time" content="2021-11-09T11:00:00+01:00"><meta property="article:modified_time" content="2021-11-09T11:00:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Seed Your MongoDB Container with JSON data using Docker and Docker-Compose"><meta name=twitter:description content><meta name=application-name content="Shan's World"><meta name=apple-mobile-web-app-title content="Shan's World"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/><link rel=prev href=https://shantanoo-desai.github.io/posts/technology/eve-eden-rpi4-telegraf/><link rel=next href=https://shantanoo-desai.github.io/posts/books/sunrise_with_seamonsters_theroux_paul/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Seed Your MongoDB Container with JSON data using Docker and Docker-Compose","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/seeding-mongodb-docker-compose\/"},"genre":"posts","keywords":"mongodb, docker-compose, docker, json","wordcount":842,"url":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/seeding-mongodb-docker-compose\/","datePublished":"2021-11-09T11:00:00+01:00","dateModified":"2021-11-09T11:00:00+01:00","publisher":{"@type":"Organization","name":"Shan"},"author":{"@type":"Person","name":"Shan"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/ title="Everything You wish to know about me">About </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/ title="Everything You wish to know about me">About</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Seed Your MongoDB Container with JSON data using Docker and Docker-Compose</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Shan</a></span>&nbsp;<span class=post-category>included in <a href=/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=09-11-2021>09-11-2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;842 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#problem>Problem</a></li><li><a href=#approach>Approach</a><ul><li><a href=#problems-faced>Problems Faced</a></li></ul></li><li><a href=#solution>Solution</a><ul><li><a href=#steps>Steps</a></li><li><a href=#files>Files</a></li></ul></li><li><a href=#comments-suggestions>Comments, Suggestions</a></li></ul></nav></div></div><div class=content id=content><h2 id=requirements>Requirements</h2><p>A couple of years ago I made a frontend app which rendered JSON data stored in-memory. The App provided a <em>check-list</em> for
Quality Management called <a href=https://github.com/shantanoo-desai/qualiexplore target=_blank rel="noopener noreffer">QualiExplore</a> (under <strong>Apache 2.0 License</strong>).</p><p>Nothing too fancy, but we needed to make the app a bit more flexible and decided to use <em>MongoDB</em> to render the information
as well as make it easy to introduce new information to the JSON data that previously persisted in the App.</p><p>Fundamentally, the app should be <em>out-of-the-box</em> usable for someone who wants to use it (with other additions currently on-going
e.g., GraphQL backend + User authentication / authorization)</p><h2 id=problem>Problem</h2><p>The JSON data, that previously persisted in the app needs to be <em>seeded</em> into the MongoDB instance once the complete stack is
brought up.</p><p>Doesn&rsquo;t sound like a bit deal, should be possible to use volume mounts with docker, right? Yup, you guessed it but MongoDB doesn&rsquo;t
just ingest data because one mounted a volume to a specific directory. To the rescue comes <code>mongoimport</code> tool where one can load
data via CLI. Seems like our problem is solved!</p><p>We it turns out I wanted to seed data into the MongoDB in a <em>litte more secure</em> manner aka. maybe use a username and password and a
dedicated initialized database where this imported data should persist under specific collections.</p><p>Turns out, once you figure out the <code>mongoimport</code> tool&rsquo;s Syntax, the next big headache was to figure out how to <em>securely</em> pass this
information to a docker image which will insert this information into Mongo.</p><p>I generally have a stack design pattern where I try to keep changes into YAML files for an end-user minimum and let the changes reflect
through the environment variables passed to the stack. So passing the environment variables to the respective docker containers shouldn&rsquo;t
be a big hassle, right? <em>Oh! how wrong I was!</em></p><h2 id=approach>Approach</h2><p>I decided to following the following sequential steps:</p><ol><li>Bring the MongoDB container up</li><li>Create a docker container that is connected to the same network as MongoDB container as above that has <code>mongoimport</code> on it</li><li>Mount the JSON data into the container in step 2 and insert the data</li><li>In order to make the ingestion of data bit more secure pass the information like the database&rsquo;s URI, credentials via environment variables</li></ol><p>So the initial project setup is as follows:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>.
├── docker-compose.yml
├── mongo_seed
│   ├── Dockerfile
│   ├── factors.json
│   └── filters.json
└── .env
</code></pre></div><p>Here, the <code>mongo_seed</code> is the directory with the data to be ingested as well as the <code>Dockerfile</code> that will perform the necessary ingestion.</p><p>The root of the directory contains the <code>docker-compose.yml</code> for the stack and its respective <code>.env</code> file for environment variables</p><h3 id=problems-faced>Problems Faced</h3><p>This requires a quick primer of Docker&rsquo;s <code>ARG</code> and <code>ENV</code> in context of <code>docker</code>. A decent read-through I used can be found
<a href=https://vsupalov.com/docker-arg-env-variable-guide/ target=_blank rel="noopener noreffer">here</a></p><p>In a nutshell</p><blockquote><p><code>ARG</code> is used during build-time i.e., when building a docker container. It&rsquo;s lifetime is short till the build is complete. Once the container
is built, they are not available for further usage.
<code>ENV</code>, on the other hand, is available for the run-time of the container too.</p></blockquote><p>A common practice that a lot of container developers use is to declare an <code>ARG</code> and then use the value of the incoming build-argument as an
<code>ENV</code> for further usage.</p><p>so something like</p><div class=highlight><pre class=chroma><code class=language-docker data-lang=docker><span class=k>ARG</span> database-uri<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>DATABASE_URI</span><span class=o>=</span><span class=k>$(</span>database-uri<span class=k>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># Use `$DATABASE_URI` to insert database</span><span class=err>
</span><span class=err>
</span></code></pre></div><p>This wasn&rsquo;t the case since I ended facing problem which I documented on
<a href=https://stackoverflow.com/questions/69886273/docker-compose-file-doesnt-pick-up-environment-variable-from-a-dedicated-env-fi target=_blank rel="noopener noreffer">StackExchange</a></p><p>The problem concisely, is the environment variables from <code>.env</code> fille passed into the <code>mongo-seed</code> container doesn&rsquo;t get set during run-time</p><h2 id=solution>Solution</h2><p>After going through some StackExchange Queries, an answer from
<a href=https://stackoverflow.com/a/69173690/4851126 target=_blank rel="noopener noreffer">Zincfan on a Query regarding getting Env Variable in Dockerfile</a> turned out to be the solution</p><h3 id=steps>Steps</h3><ul><li>Declare Same <code>ARG</code> and <code>ENV</code> of the same name as that of the environment variables</li><li>Get the information from the build-argument and store the information into the env. variable using the syntax:
<code>ARG DATABASE_URI ENV DATABASE_URI ${DATABASE_URI}</code></li><li>use <code>${DATABASE_URI}</code> in the run-time of the container</li><li>to pass the information from the <code>.env</code> passed to the compose file should be in the following way:<div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w> </span><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>     </span><span class=k>mongo-seed</span><span class=p>:</span><span class=w>
</span><span class=w>         </span><span class=k>args</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- DATABASE_URI=$DATABASE_URI<span class=w>
</span></code></pre></div></li></ul><h3 id=files>Files</h3><p>So finally my <code>Dockerfile</code> looks like the following:</p><div class=highlight><pre class=chroma><code class=language-docker data-lang=docker><span class=k>FROM</span><span class=s> mongo:5.0</span><span class=err>
</span><span class=err></span> <span class=c1># Will be set through Environment Files</span><span class=err>
</span><span class=err></span> ARG DATABASE_URI<span class=err>
</span><span class=err></span> ARG USERNAME<span class=err>
</span><span class=err></span> ARG PASSWORD<span class=err>
</span><span class=err>
</span><span class=err></span> ENV DATABASE_URI <span class=si>${</span><span class=nv>DATABASE_URI</span><span class=si>}</span><span class=err>
</span><span class=err></span> ENV USERNAME <span class=si>${</span><span class=nv>USERNAME</span><span class=si>}</span><span class=err>
</span><span class=err></span> ENV PASSWORD <span class=si>${</span><span class=nv>PASSWORD</span><span class=si>}</span><span class=err>
</span><span class=err>
</span><span class=err></span> COPY factors.json /factors.json<span class=err>
</span><span class=err>
</span><span class=err></span> COPY filters.json /filters.json<span class=err>
</span><span class=err>
</span><span class=err></span> CMD mongoimport --username <span class=si>${</span><span class=nv>USERNAME</span><span class=si>}</span> --password <span class=si>${</span><span class=nv>PASSWORD</span><span class=si>}</span> --uri <span class=si>${</span><span class=nv>DATABASE_URI</span><span class=si>}</span> --collection factors --drop --file /factors.json <span class=o>&amp;&amp;</span> <span class=se>\
</span><span class=se></span>     mongoimport --username <span class=si>${</span><span class=nv>USERNAME</span><span class=si>}</span> --password <span class=si>${</span><span class=nv>PASSWORD</span><span class=si>}</span> --uri <span class=si>${</span><span class=nv>DATABASE_URI</span><span class=si>}</span> --collection filters --drop --file /filters.json<span class=err>
</span><span class=err>
</span><span class=err>
</span></code></pre></div><p><strong>Good to Note</strong>: Never split into two <code>CMD</code> in the file, rather merge multiple commands into one <code>CMD</code>.</p><p>my <code>docker-compose.yml</code> file looks like the following:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>services</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=c># MongoDB</span><span class=w>
</span><span class=w>    </span><span class=k>mongo</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>container_name</span><span class=p>:</span><span class=w> </span>mongodb<span class=w>
</span><span class=w>        </span><span class=k>image</span><span class=p>:</span><span class=w> </span>mongo<span class=p>:</span>latest<span class=w>
</span><span class=w>        </span><span class=k>env_file</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- .env<span class=w>
</span><span class=w>        </span><span class=k>ports</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;27017:27017&#34;</span><span class=w>
</span><span class=w>        </span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;qualiexplore_net&#34;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=c># Initial Seed to QualiExplore Database</span><span class=w>
</span><span class=w>    </span><span class=k>mongo-seed</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>env_file</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- .env<span class=w>
</span><span class=w>        </span><span class=k>build</span><span class=p>:</span><span class=w>
</span><span class=w>            </span><span class=k>context</span><span class=p>:</span><span class=w> </span>./mongo_seed<span class=w>
</span><span class=w>            </span><span class=k>dockerfile</span><span class=p>:</span><span class=w> </span>Dockerfile<span class=w>
</span><span class=w>            </span><span class=k>args</span><span class=p>:</span><span class=w>
</span><span class=w>                </span>- DATABASE_URI=$DATABASE_URI<span class=w>
</span><span class=w>                </span>- USERNAME=$MONGO_INITDB_ROOT_USERNAME<span class=w>
</span><span class=w>                </span>- PASSWORD=$MONGO_INITDB_ROOT_PASSWORD<span class=w>
</span><span class=w>        </span><span class=k>depends_on</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- mongo<span class=w>
</span><span class=w>        </span><span class=k>networks</span><span class=p>:</span><span class=w>
</span><span class=w>            </span>- <span class=s2>&#34;qualiexplore_net&#34;</span><span class=w>
</span></code></pre></div><p>My <code>.env</code> file is as follows:</p><pre><code>MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=example
MONGO_INITDB_DATABASE=qualiexplore
DATABASE_URI=mongodb://mongodb:27017/qualiexplore?authSource=admin****
</code></pre><h2 id=comments-suggestions>Comments, Suggestions</h2><p>If you would like to suggest me some changes in my design or a better way to tackle this situation, I am all ears
and would love to improve and discuss aspects. You can contact me on <code>LinkedIn</code> or via E-Mail.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 09-11-2021</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/ data-title="Seed Your MongoDB Container with JSON data using Docker and Docker-Compose" data-hashtags=mongodb,docker-compose,docker,json><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/ data-hashtag=mongodb><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/ data-title="Seed Your MongoDB Container with JSON data using Docker and Docker-Compose" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/ data-title="Seed Your MongoDB Container with JSON data using Docker and Docker-Compose"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://shantanoo-desai.github.io/posts/technology/seeding-mongodb-docker-compose/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/mongodb/>mongodb</a>,&nbsp;<a href=/tags/docker-compose/>docker-compose</a>,&nbsp;<a href=/tags/docker/>Docker</a>,&nbsp;<a href=/tags/json/>json</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/technology/eve-eden-rpi4-telegraf/ class=prev rel=prev title="Observe your Raspberry Pi EVE Device's CPU Usage with Telegraf and InfluxDB - Part 4"><i class="fas fa-angle-left fa-fw"></i>Observe your Raspberry Pi EVE Device's CPU Usage with Telegraf and InfluxDB - Part 4</a>
<a href=/posts/books/sunrise_with_seamonsters_theroux_paul/ class=next rel=next title="Sunrise with Seamonsters by Paul Theroux">Sunrise with Seamonsters by Paul Theroux<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.70.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>