<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations - Shan's Corner</title><meta name=Description content="Shan's World"><meta property="og:title" content="Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/"><meta property="article:published_time" content="2022-03-26T13:54:57+01:00"><meta property="article:modified_time" content="2022-03-26T13:54:57+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations"><meta name=twitter:description content><meta name=application-name content="Shan's World"><meta name=apple-mobile-web-app-title content="Shan's World"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/><link rel=prev href=https://shantanoo-desai.github.io/posts/technology/portainer-docker-secrets/><link rel=next href=https://shantanoo-desai.github.io/posts/technology/node-red-docker/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/docker-compose-offline-stack\/"},"genre":"posts","keywords":"docker, docker-compose","wordcount":467,"url":"https:\/\/shantanoo-desai.github.io\/posts\/technology\/docker-compose-offline-stack\/","datePublished":"2022-03-26T13:54:57+01:00","dateModified":"2022-03-26T13:54:57+01:00","publisher":{"@type":"Organization","name":"Shan"},"author":{"@type":"Person","name":"Shan"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/now title="What am I currently focusing on">Now </a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/ title="Everything You wish to know about me">About </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shan's Corner">Shan's Corner</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/now title="What am I currently focusing on">Now</a><a class=menu-item href=/posts/ title="My thoughts and works digitally transcribed">Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/about/ title="Everything You wish to know about me">About</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animated flipInX">Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Shan</a></span>&nbsp;<span class=post-category>included in <a href=/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=26-03-2022>26-03-2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;467 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div></div><div class=content id=content><h2 id=requirements>Requirements</h2><p>Many a times you might have requirement to run Docker on a Raspberry Pi or other SBCs that may
have to do run some applications without any internet connections. You might have initially
developed your application only by keeping in mind a Docker Artifact and was meant to run as
complete stack using <code>docker-compose.yml</code>.</p><p>In almost all cases, bringing the stack up will pull the images from a registry through the Internet.
But when you wish to deploy some SBCs into a space where there is no Internet to begin with you might
have to either develop your code artifact as a package or binary bundle. If this application requires
dependencies on some Databases then you will have to write tedious bash scripts to prepare the device
for some pre-installtion.</p><p>Seems like a lot of refactoring / re-thinking to do!</p><p>Do not worry <code>docker</code> has things sorted out, and provides <code>docker save</code> and <code>docker load</code> functionalities.</p><h2 id=scenario>Scenario</h2><p>Let&rsquo;s consider an Open-Source Stack <a href=https://github.com/shantanoo-desai/tiguitto target=_blank rel="noopener noreffer">tiguitto</a> for IoT at Edge.
It comprises of some standard apps like an <strong>MQTT Broker</strong>, <strong>InfluxDB</strong>, <strong>Telegraf</strong>, <strong>Grafana</strong>. All these
components are combined through a <code>docker-compose.yml</code> file.</p><p>Now, as previously mentioned shipping the stack would have been easy, had we had Internet on the target node.
Simply sending the compose file to the node would have done everything for us.</p><p>For cases where we do not have Internet access, we have to ship two things:</p><ol><li><code>docker-compose.yml</code></li><li>Compressed Tar-Ball for services present in the compose file</li></ol><h3 id=usage-steps>Usage Steps</h3><p>Assume we have our development machine with <code>docker</code> and <code>docker-compose</code> on them.</p><ol><li><p>We make sure to remove all not-used, unnecessary images are cleared from the machine and only the images
of our application exists.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash> docker images -a <span class=c1># check existing images on dev machine</span>
</code></pre></div><p>If you wish to remove everything and only pull the required images do:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash> docker rmi <span class=k>$(</span>docker images <span class=p>|</span> awk <span class=s2>&#34;NR&gt;0 {print</span><span class=nv>$3</span><span class=s2>}&#34;</span><span class=k>)</span>
</code></pre></div></li><li><p>Pull the images with their dedicated tags using <code>docker pull &lt;image_name>:&lt;tag></code></p></li><li><p>Check using <code>docker images -a</code></p></li><li><p>Now leverage <code>docker save</code> along with some format parsing using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker save -o myStack.tar <span class=k>$(</span>docker images --format <span class=s2>&#34;{{.Repository}}:{{.Tag}}&#34;</span><span class=k>)</span>
</code></pre></div></li></ol><p><code>docker save</code> combines the image into their respective Tar balls however we need to tell <code>docker</code>
that we need to combine all the images existing on the dev machine into a combined Tar ball. This
is done through <code>--format "{{.Repository}}:{{.Tag}}"</code></p><ol start=5><li>This should produce <code>myStack.tar</code> in your directory</li></ol><h2 id=unpack-your-tarball-and-test>Unpack your Tarball and Test</h2><p>If you are doing this on a laptop or PC, try switching your network connection off now.</p><ol><li>Unpack your Tarball</li></ol><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  docker load -i myStack.tar
</code></pre></div><ol start=2><li><p>Check with <code>docker images -a</code></p></li><li><p>You can now <code>docker-compose up</code> and your application should work offline</p></li></ol><p>If you use some other ways of using shipping your Docker and Compose applications, get in touch with me and
would like to learn from you!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 26-03-2022</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/ data-title="Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations" data-hashtags=docker,docker-compose><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/ data-title="Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/ data-title="Nugget: Prepare your Docker-Compose Stack as a Tarball for Offline Installations"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://shantanoo-desai.github.io/posts/technology/docker-compose-offline-stack/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/docker/>docker</a>,&nbsp;<a href=/tags/docker-compose/>docker-compose</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/technology/portainer-docker-secrets/ class=prev rel=prev title="Use Docker Secret to set your Portainer Admin User's Password"><i class="fas fa-angle-left fa-fw"></i>Use Docker Secret to set your Portainer Admin User's Password</a>
<a href=/posts/technology/node-red-docker/ class=next rel=next title="Create a custom Node-Red Container with Integration Testing">Create a custom Node-Red Container with Integration Testing<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.70.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>